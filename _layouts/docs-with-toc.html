---
layout: default
---

{{ content }}

<!-- Include TOC for all docs pages -->
{% if page.layout == "docs" or layout.name == "docs" %}
<script>
// Table of Contents functionality for just-the-docs
document.addEventListener('DOMContentLoaded', function() {
    // Wait a bit for just-the-docs to load
    setTimeout(function() {
        generateTOC();
        updateActiveSection();
        
        // Update active section on scroll
        window.addEventListener('scroll', updateActiveSection);
    }, 200);
});

function generateTOC() {
    // Look for content in just-the-docs structure
    const content = document.querySelector('.main-content') || 
                   document.querySelector('.main') || 
                   document.querySelector('#main-content') ||
                   document.querySelector('main') ||
                   document.querySelector('.site-main') ||
                   document.querySelector('[role="main"]');
    
    if (!content) {
        console.log('No main content found for TOC');
        return;
    }
    
    // Find all headings in the content
    const headings = content.querySelectorAll('h1, h2, h3, h4, h5, h6');
    console.log('Found headings:', headings.length);
    
    if (headings.length < 2) return; // Don't show TOC if less than 2 headings
    
    // Create TOC container
    const tocContainer = document.createElement('div');
    tocContainer.className = 'toc-right';
    tocContainer.id = 'toc-sidebar';
    
    // Create TOC title
    const tocTitle = document.createElement('h3');
    tocTitle.textContent = 'Table of Contents';
    tocContainer.appendChild(tocTitle);
    
    // Create TOC list
    const tocList = document.createElement('ul');
    
    let tocHTML = '';
    
    headings.forEach((heading, index) => {
        // Skip headings with .no_toc class
        if (heading.classList.contains('no_toc')) return;
        
        // Create an ID if the heading doesn't have one
        if (!heading.id) {
            const text = heading.textContent.trim().toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-');
            heading.id = text || 'heading-' + index;
        }
        
        const level = heading.tagName.toLowerCase();
        const text = heading.textContent.trim();
        const link = '#' + heading.id;
        
        // Skip empty headings
        if (!text) return;
        
        // Clean up text for display
        let displayText = text;
        if (text.includes('ðŸ”¹')) {
            displayText = text.replace('ðŸ”¹', '').trim();
        }
        
        tocHTML += `<li><a href="${link}" class="toc-${level}" data-target="${heading.id}">${displayText}</a></li>`;
    });
    
    if (tocHTML) {
        tocList.innerHTML = tocHTML;
        tocContainer.appendChild(tocList);
        document.body.appendChild(tocContainer);
        
        console.log('TOC generated with', tocHTML.split('<li>').length - 1, 'items');
        
        // Add click handlers for smooth scrolling
        const tocLinks = tocContainer.querySelectorAll('a');
        tocLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('data-target');
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    } else {
        console.log('No TOC items generated');
    }
}

function updateActiveSection() {
    const tocLinks = document.querySelectorAll('.toc-right a');
    if (tocLinks.length === 0) return;
    
    let activeLink = null;
    const scrollPosition = window.scrollY + 150;
    
    tocLinks.forEach(link => {
        const targetId = link.getAttribute('data-target');
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
            const elementTop = targetElement.offsetTop;
            
            if (scrollPosition >= elementTop) {
                activeLink = link;
            }
        }
    });
    
    // Update active states
    tocLinks.forEach(link => link.classList.remove('toc-active'));
    if (activeLink) {
        activeLink.classList.add('toc-active');
    }
}
</script>

<style>
/* Inline TOC styles to ensure they load */
.toc-right {
  position: fixed;
  right: 20px;
  top: 120px;
  width: 260px;
  max-height: calc(100vh - 200px);
  overflow-y: auto;
  background: #f6f8fa;
  border: 1px solid #d1d9e0;
  border-radius: 8px;
  padding: 16px;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  font-size: 14px;
  line-height: 1.4;
}

.dark-scheme .toc-right {
  background: #2d333b;
  border-color: #444c56;
}

.toc-right h3 {
  margin: 0 0 12px 0;
  font-size: 16px;
  font-weight: 600;
  color: #24292e;
  padding-bottom: 8px;
  border-bottom: 1px solid #d1d9e0;
}

.dark-scheme .toc-right h3 {
  color: #adbac7;
  border-bottom-color: #444c56;
}

.toc-right ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

.toc-right li {
  margin: 0;
  padding: 2px 0;
}

.toc-right a {
  display: block;
  padding: 4px 8px;
  text-decoration: none;
  color: #24292e;
  border-radius: 4px;
  transition: all 0.2s ease;
  word-wrap: break-word;
  hyphens: auto;
}

.dark-scheme .toc-right a {
  color: #adbac7;
}

.toc-right a:hover {
  background-color: #f6f8fa;
  color: #0969da;
}

.dark-scheme .toc-right a:hover {
  background-color: #373e47;
  color: #539bf5;
}

.toc-right .toc-active {
  background-color: #0969da !important;
  color: white !important;
  font-weight: 600;
}

.dark-scheme .toc-right .toc-active {
  background-color: #539bf5 !important;
  color: #1c2128 !important;
}

.toc-right .toc-h2 {
  font-weight: 600;
}

.toc-right .toc-h3 {
  padding-left: 16px;
  font-weight: 500;
}

.toc-right .toc-h4 {
  padding-left: 32px;
  font-weight: 400;
  font-size: 13px;
}

@media (max-width: 1400px) {
  .toc-right {
    display: none;
  }
}

@media (min-width: 1400px) {
  .main-content-wrap {
    padding-right: 300px;
  }
}
</style>
{% endif %}
